# ğŸ“š BookMall Microservices

![Go](https://img.shields.io/badge/Go-1.18+-00ADD8?style=flat&logo=go)
![go-zero](https://img.shields.io/badge/Framework-go--zero-brightgreen)
![Architecture](https://img.shields.io/badge/Architecture-Microservices-orange)

## ğŸ“– é¡¹ç›®ç®€ä»‹ (Introduction)

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº **Go** è¯­è¨€å’Œ **go-zero** æ¡†æ¶æ„å»ºçš„é«˜æ€§èƒ½å¾®æœåŠ¡åç«¯ç³»ç»Ÿã€‚

é¡¹ç›®æ—¨åœ¨å±•ç¤º**ä¼ä¸šçº§å¾®æœåŠ¡æ¶æ„**çš„æœ€ä½³å®è·µã€‚å®ƒä¸ä»…åŒ…å«åŸºç¡€çš„ç”¨æˆ·é‰´æƒä¸å›¾ä¹¦æœç´¢åŠŸèƒ½ï¼Œè¿˜å®ç°äº†ä¸€ä¸ª**å®Œæ•´çš„å›¾ä¹¦å€Ÿé˜…ä¸šåŠ¡é—­ç¯**ï¼Œæ¶µç›–äº†åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„**åº“å­˜ç®¡ç†**ã€**ç§¯åˆ†æ‰£å‡**ä»¥åŠ**æ•°æ®ä¸€è‡´æ€§ä¿éšœï¼ˆå›æ»šæœºåˆ¶ï¼‰**ã€‚

é€šè¿‡ API Gateway (Search Service) èšåˆåç«¯ RPC æœåŠ¡ (User & Stock Service)ï¼Œæ¨¡æ‹Ÿäº†é«˜å¹¶å‘åœºæ™¯ä¸‹çš„æµé‡å¤„ç†ä¸æœåŠ¡åè°ƒã€‚

## ğŸ— ç³»ç»Ÿæ¶æ„ (Architecture)

é¡¹ç›®é‡‡ç”¨ç»å…¸çš„å¾®æœåŠ¡åˆ†å±‚æ¶æ„ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒæœåŠ¡ï¼š

### 1. ğŸ” Search Service (API Gateway)
å¯¹å¤–æš´éœ² HTTP æ¥å£ï¼Œä½œä¸ºæµé‡å…¥å£ã€‚
- **Search**: æä¾›é«˜æ•ˆçš„å›¾ä¹¦æ£€ç´¢åŠŸèƒ½ã€‚
- **Borrow [New]**: å¤„ç†å€Ÿé˜…è¯·æ±‚çš„æ ¸å¿ƒç¼–æ’å±‚ã€‚å®ƒåè°ƒ User å’Œ Stock æœåŠ¡ï¼Œç¡®ä¿ä¸šåŠ¡é€»è¾‘çš„å®Œæ•´æ€§ã€‚
- **Cron [New]**: å†…ç½®å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ (`cron_scheduler`)ï¼Œç”¨äºå¤„ç†åå°å¼‚æ­¥ä»»åŠ¡ã€‚
- **Middleware**: é›†æˆ `TimeListener` ä¸­é—´ä»¶ï¼Œç›‘æ§æ ¸å¿ƒæ¥å£å“åº”è€—æ—¶ã€‚

### 2. ğŸ‘¤ User Service (RPC)
è´Ÿè´£ç”¨æˆ·èµ„äº§ä¸èº«ä»½ç®¡ç†ã€‚
- **Auth**: åŸºäº JWT çš„ Token ç”Ÿæˆä¸æ ¡éªŒã€‚
- **Points [New]**: å®ç°äº†ç§¯åˆ†æ‰£å‡ (`DecrPoints`) åŠ**åˆ†å¸ƒå¼å›æ»š** (`DecrPointsRollback`) æ¥å£ï¼Œé˜²æ­¢å€Ÿé˜…å¤±è´¥åçš„ç§¯åˆ†ä¸¢å¤±ã€‚

### 3. ğŸ“¦ Stock Service (RPC) [New]
ç‹¬ç«‹ç®¡ç†çš„åº“å­˜å¾®æœåŠ¡ã€‚
- **Inventory**: å®ç°äº†é«˜å¹¶å‘ä¸‹çš„åº“å­˜æ‰£å‡ (`Deduct`)ã€‚
- **Consistency**: æä¾›åº“å­˜å›æ»š (`DeductRollback`) æ¥å£ï¼Œæ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡çš„è¡¥å¿æœºåˆ¶ã€‚

---

## âœ¨ æ ¸å¿ƒäº®ç‚¹ (Key Features)

### 1. åˆ†å¸ƒå¼äº‹åŠ¡ä¸æ•°æ®ä¸€è‡´æ€§ [New]
åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œè·¨æœåŠ¡çš„â€œå€Ÿé˜…â€æ“ä½œæ¶‰åŠåº“å­˜ä¸ç§¯åˆ†çš„åŒé‡å˜æ›´ã€‚æœ¬é¡¹ç›®æ‘’å¼ƒäº†ç®€å•çš„æœ¬åœ°äº‹åŠ¡ï¼Œå®ç°äº†åŸºäº **ä¸šåŠ¡è¡¥å¿ï¼ˆRollbackï¼‰** çš„æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆï¼š
- å½“å€Ÿé˜…æµç¨‹ä¸­ä»»ä¸€æ­¥éª¤ï¼ˆå¦‚æ‰£å‡åº“å­˜ï¼‰å¤±è´¥æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è§¦å‘å›æ»šé€»è¾‘ï¼Œæ¢å¤å·²æ‰£å‡çš„ç”¨æˆ·ç§¯åˆ†ï¼Œç¡®ä¿æ•°æ®â€œè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥â€ã€‚

### 2. æ ‡å‡†åŒ–å·¥ç¨‹è§„èŒƒ (Standardized Engineering)
ç»§æ‰¿è‡ªåŸæœ‰æ¶æ„çš„ä¼˜ç§€å®è·µï¼š
- **Unified Error Handling**: åœ¨ `common/xerr` ä¸­å®šä¹‰äº†å…¨å±€ç»Ÿä¸€çš„é”™è¯¯ç ä¸é”™è¯¯å¤„ç†é€»è¾‘ï¼Œè§£å†³äº†å¾®æœåŠ¡è°ƒç”¨é“¾ä¸­é”™è¯¯ä¸Šä¸‹æ–‡ä¸¢å¤±çš„é—®é¢˜ã€‚
- **Structured Response**: å°è£… `common/response`ï¼Œç¡®ä¿æ‰€æœ‰ API è¿”å›ä¸€è‡´çš„ JSON ç»“æ„ (`code`, `msg`, `data`)ã€‚

### 3. é«˜æ€§èƒ½é€šä¿¡ (High-Performance Communication)
- **gRPC Integration**: å†…éƒ¨æœåŠ¡é—´ï¼ˆSearch -> User/Stockï¼‰ä½¿ç”¨ **gRPC** è¿›è¡Œé€šä¿¡ï¼Œåˆ©ç”¨ Protobuf çš„äºŒè¿›åˆ¶åºåˆ—åŒ–ä¼˜åŠ¿ï¼Œæ˜¾è‘—é™ä½ç½‘ç»œå¼€é”€ã€‚
- **Etcd Discovery**: é›†æˆæœåŠ¡å‘ç°æœºåˆ¶ï¼Œæ”¯æŒæœåŠ¡çš„åŠ¨æ€æ‰©ç¼©å®¹ã€‚

---

## ğŸ“‚ ç›®å½•ç»“æ„ (Directory Structure)

```text
.
â”œâ”€â”€ common/             # é€šç”¨ç»„ä»¶ (Error handling, Response wrapper)
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ search/         # [API Gateway] æœç´¢ä¸å€Ÿé˜…ç½‘å…³
â”‚   â”‚   â”œâ”€â”€ api/internal/logic/borrow_logic.go    # å€Ÿé˜…ç¼–æ’é€»è¾‘ (å«å›æ»šè°ƒç”¨)
â”‚   â”‚   â”œâ”€â”€ api/internal/cron/                    # å®šæ—¶ä»»åŠ¡
â”‚   â”‚   â””â”€â”€ api/internal/middleware/              # è€—æ—¶ç›‘æ§ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ user/           # [RPC Service] ç”¨æˆ·ä¸ç§¯åˆ†
â”‚   â”‚   â”œâ”€â”€ rpc/internal/logic/decr_points_logic.go # ç§¯åˆ†æ‰£å‡
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ stock/          # [RPC Service] åº“å­˜ç®¡ç† (æ–°å¢)
â”‚       â”œâ”€â”€ rpc/internal/logic/deduct_logic.go      # åº“å­˜æ‰£å‡
â”‚       â””â”€â”€ ...
â””â”€â”€ go.mod
```

## ğŸš€ å¿«é€Ÿå¼€å§‹ (Getting Started)

### å‰ç½®è¦æ±‚ (Prerequisites)

* Go 1.18+
* Etcd (æœåŠ¡å‘ç°)
* Redis & MySQL

### å¯åŠ¨æœåŠ¡ (Running the Services)

è¯·æŒ‰ç…§ä¾èµ–é¡ºåºå¯åŠ¨æœåŠ¡ï¼š

1. **å¯åŠ¨ User RPC æœåŠ¡**
```bash
cd service/user/rpc
go run user.go

```


2. **å¯åŠ¨ Stock RPC æœåŠ¡** (æ–°å¢)
```bash
cd service/stock/rpc
go run stock.go

```


3. **å¯åŠ¨ Search API æœåŠ¡** (ç½‘å…³)
```bash
cd service/search/api
go run search.go

```
